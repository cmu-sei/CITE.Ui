<!--
Copyright 2022 Carnegie Mellon University. All Rights Reserved.
 Released under a MIT (SEI)-style license, please see LICENSE.md in the project root for license information or contact permission@sei.cmu.edu for full terms.
-->

<div class="cssLayoutRowStartCenter">
  <div class="sp-icon">
    <mat-icon
      svgIcon="account_group"
      [ngStyle]="{'color': topbarColor}"
    ></mat-icon>
  </div>
  <mat-icon
    style="margin-left: 20px; transform: scale(0.85); margin-right: 5px;"
    class="icon-color"
    svgIcon="ic_magnify_search"
  ></mat-icon>
  <mat-form-field style="width: 300px;">
    <input matInput [formControl]="filterControl" placeholder="Search" />
  </mat-form-field>
  <div style="width: 30px;">
    <button
      mat-icon-button
      (click)="applyFilter('')"
      style="outline: none;"
      title="Clear Search"
    >
      <mat-icon class="mdi-24px" fontIcon="mdi-close-circle-outline"></mat-icon>
    </button>
  </div>
  <div class="button-margins">
    <span *ngIf="!addingNewGroup">
      <button mat-stroked-button (click)="addGroup()">Add Group</button>
    </span>
    <span *ngIf="addingNewGroup">
      Name:
      <input type="text" [(ngModel)]="newGroupName" (keydown)="handleInput($event)" />
      <button mat-icon-button [disabled]="newGroupName.length < 3" (click)="saveNewGroup()">
        <mat-icon class="icon-color" svgIcon="completion"></mat-icon>
      </button>
      <button mat-icon-button (click)="cancelGroupAdd()">
        <mat-icon class="icon-color" svgIcon="ic_cancel_circle"></mat-icon>
      </button>
    </span>
  </div>
  <div *ngIf="!addingNewGroup">
    <mat-paginator
      #paginator
      [length]="groupList?.length"
      [pageIndex]="pageIndex"
      [pageSize]="pageSize"
      [pageSizeOptions]="[5, 10, 15, 20, 25, 50, 100, 200]"
      (page)="paginatorEvent($event)"
    ></mat-paginator>
  </div>
</div>

<mat-accordion displayMode="flat">
  <section
    matSort
    (matSortChange)="sortChanged($event)"
    class="mat-elevation-z2 mat-header-row"
  >
    <span class="mat-header-cell" mat-sort-header="name">Name</span>
    <span class="mat-header-cell" mat-sort-header="moveNumber">Current Move</span>
    <span class="mat-header-cell" mat-sort-header="status">Status</span>
  </section>

  <mat-expansion-panel
    *ngFor="let group of paginateGroups(groupList, pageIndex, pageSize)"
    [expanded]="editGroup.id === group.id"
  >
    <mat-expansion-panel-header class="mat-row" *ngIf="!isLoading" (click)="togglePanel(group); $event.stopPropagation()">
      <span class="mat-cell">
        <button
          mat-icon-button
          ngxClipboard
          (click)="$event.stopPropagation()"
          title="Copy ID:  {{ group.id }}"
        >
          <mat-icon class="mdi-24px" fontIcon="mdi-content-copy"></mat-icon>
        </button>
        {{ group.name }}
      </span>
    </mat-expansion-panel-header>
    <div class="panel-container" *ngIf="editGroup.id === group.id">
      <div class="panel-div">
        <mat-form-field class="name-width">
          <mat-label>Group Name</mat-label>
          <input matInput [(ngModel)]="editGroup.name" (keydown)="handleInput($event)" />
        </mat-form-field>
        <button mat-icon-button [disabled]="editGroup.name.length < 3" (click)="saveGroup()" title="Save">
          <mat-icon class="icon-color" svgIcon="completion"></mat-icon>
        </button>
        <button mat-icon-button (click)="cancelEdit()" title="Cancel">
          <mat-icon class="icon-color" svgIcon="ic_cancel_circle"></mat-icon>
        </button>
      </div>
      <div class="team-div">
        <app-admin-group-teams *ngIf="group.id === editGroup.id"
          [groupId]="group.id"
          [teamList]="teamList"
        ></app-admin-group-teams>
      </div>
    </div>
  </mat-expansion-panel>
</mat-accordion>

<mat-card
  *ngIf="isLoading"
  style="display: flex; justify-content: center; align-items: center;"
>
  <mat-progress-spinner color="primary" mode="indeterminate">
  </mat-progress-spinner>
</mat-card>
